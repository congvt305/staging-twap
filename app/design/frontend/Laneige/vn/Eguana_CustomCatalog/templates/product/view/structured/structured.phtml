<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

/** @var $block \Magento\Catalog\Block\Product\View */
/* @var $additionalData \Eguana\CustomCatalog\ViewModel\GetAdditional */

$additionalData = $block->getData('model_additional_data');
$categoryName = '';
$categoryIds = $block->getProduct()->getCategoryIds();
if ($categoryIds && count($categoryIds) > 0) {
    $categoryId = $categoryIds[0];
    $category = $additionalData->getCategory($categoryId);
    if ($category && $category->getId()) {
        $categoryName = $category->getName();
    }
}
$isSalable = $block->getProduct()->getIsSalable();
if ($isSalable) {
<<<<<<< HEAD
    $availability = 'https://schema.org/InStock';
} else {
    $availability = 'https://schema.org/OutOfStock';
}
$shortDescription = $this->helper(Magento\Catalog\Helper\Output::class)->productAttribute(
    $block->getProduct(),
    $block->getProduct()->getShortDescription(),
    'short_description'
);
if ($shortDescription) {
    $shortDescription = trim(preg_replace('/\s\s+/',' ', $shortDescription));
}
if ($block->getProduct()->getTypeId() == 'bundle') {
    $price = $block->getProduct()->getPriceInfo()->getPrice('final_price')->getMinimalPrice()->getValue();
} else {
    $price = $block->getProduct()->getFinalPrice();
=======
    $availability = 'in stock';
} else {
    $availability = 'out of stock';
>>>>>>> 416252f121972624e5951ac951e94ac1a0149f85
}
?>
<script type="application/ld+json">
    {
        "@context": "https://schema.org/",
        "@type": "Product",
        "productID": "<?= /* @noEscape */ $block->escapeHtml($block->getProduct()->getId()) ?>",
        "name": "<?= /* @noEscape */ $block->escapeHtml($block->getProduct()->getName()) ?>",
        "description": "<?= /* @noEscape */ $block->escapeHtml($block->getProduct()->getShortDescription()) ?>",
        "url": "<?= /* @noEscape */ $block->escapeHtml($block->getProduct()->getProductUrl()) ?>",
        "image": "<?= $block->escapeUrl($additionalData->getImageUrl($block->getImage($block->getProduct(), 'product_base_image')->getImageUrl())) ?>",
        "brand": "LANGEIGE",
        "offers": [
        {
          "@type": "Offer",
          "price": "<?= /* @noEscape */ (int) $block->escapeHtml($block->getProduct()->getFinalPrice()) ?>",
          "priceCurrency": "<?= $additionalData->getCurrencyCode() ?>",
          "itemCondition": "https://schema.org/NewCondition",
          "availability": "<?= $availability ?>"
        }],
        "additionalProperty": [{
            "@type": "PropertyValue",
            "propertyID": "item_group_id",
            "value": "<?= /* @noEscape */  $categoryName ?>"
            }
        ]
        "productID": "<?= /* @noEscape */ $block->escapeHtml($block->getProduct()->getSku()) ?>",
        "name": "<?= /* @noEscape */ $block->escapeHtml($block->getProduct()->getName()) ?>",
         "description": "<?= /* @noEscape */ $shortDescription ? $block->stripTags($shortDescription) : $block->escapeHtml($block->getProduct()->getName()) ?>",
        "url": "<?= /* @noEscape */ $block->escapeHtml($block->getProduct()->getProductUrl()) ?>",
        "image": "<?= $block->escapeUrl($additionalData->getImageUrl($block->getImage($block->getProduct(), 'product_base_image')->getImageUrl())) ?>",
        "brand": "LANGEIGE",
        "offers": {
          "@type": "Offer",
         "price": "<?= /* @noEscape */ $block->escapeHtml(round($price)) ?>",
          "priceCurrency": "VND",
          "availability": "<?= $availability ?>"
        }
    }
</script>
