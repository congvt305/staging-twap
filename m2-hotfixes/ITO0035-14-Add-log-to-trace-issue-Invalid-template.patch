From 481ef9e9a522ea859d7a714a53c4321a204c7643 Mon Sep 17 00:00:00 2001
From: Hoang Phan <hoangphan@amorepacific.com>
Date: Mon, 10 Oct 2022 04:08:31 -0400
Subject: [PATCH] ITO0035-14 Add log to trace issue Invalid template file

---
 vendor/magento/framework/View/Element/Template.php | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/vendor/magento/framework/View/Element/Template.php b/vendor/magento/framework/View/Element/Template.php
index e9f164c..f800501 100644
--- a/vendor/magento/framework/View/Element/Template.php
+++ b/vendor/magento/framework/View/Element/Template.php
@@ -276,6 +276,24 @@ class Template extends AbstractBlock
             $templatePath = $fileName ?: $this->getTemplate();
             $errorMessage = "Invalid template file: '{$templatePath}' in module: '{$this->getModuleName()}'"
                 . " block's name: '{$this->getNameInLayout()}'";
+
+            if ($this->getModuleName() == 'Magento_Cms') {
+               $writer = new \Zend_Log_Writer_Stream(BP . '/var/log/log-for-ticket-ITO0035-14.log');
+               $logger = new \Zend_Log();
+               $logger->addWriter($writer);
+               $logger->info($errorMessage);
+               $logger->info('filename: '. $fileName);
+               $logger->info('full action name: '. $this->getRequest()->getFullActionName());
+               $logger->info('request uri: ' . $_SERVER['REQUEST_URI']);
+               $logger->info('block data: ' . json_encode($this->getData()));
+               $logger->info('==================== Error Trace ====================');
+               $logger->info($exception->getTraceAsString());
+            }
+
             if ($this->_appState->getMode() === \Magento\Framework\App\State::MODE_DEVELOPER) {
                 throw new \Magento\Framework\Exception\ValidatorException(
                     new \Magento\Framework\Phrase(
--
2.25.1

