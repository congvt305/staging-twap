From 1495a7e12d8ecba4fbc7ae424e9c4f557d636107 Mon Sep 17 00:00:00 2001
From: Hoang Phan <hoangphan@amorepacific.com>
Date: Wed, 16 Nov 2022 05:50:18 -0500
Subject: [PATCH] ITO0016-43 Fixed Issue filter does not work

---
 vendor/magento/module-elasticsearch/Model/ResourceModel/Fulltext/Collection/SearchResultApplier.php | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/vendor/magento/module-elasticsearch/Model/ResourceModel/Fulltext/Collection/SearchResultApplier.php b/vendor/magento/module-elasticsearch/Model/ResourceModel/Fulltext/Collection/SearchResultApplier.php
index 97cb92a..e4be9ea 100644
--- a/vendor/magento/module-elasticsearch/Model/ResourceModel/Fulltext/Collection/SearchResultApplier.php
+++ b/vendor/magento/module-elasticsearch/Model/ResourceModel/Fulltext/Collection/SearchResultApplier.php
@@ -231,6 +231,11 @@ class SearchResultApplier implements SearchResultApplierInterface
             . ' AND cat_index.store_id = ' . $storeId,
             ['cat_index.position']
         );
+        $productIds = [];
+        foreach ($this->searchResult->getItems() as $item) {
+            $productIds[] = $item->getId();
+        }
+        $query->where('e.entity_id IN(?)', $productIds);
         foreach ($sortOrders as $field => $dir) {
             if ($field === 'name') {
                 $entityTypeId = $this->collection->getEntity()->getTypeId();
--
2.25.1

